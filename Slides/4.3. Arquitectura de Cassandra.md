---
title       : Apache Cassandra - Arquitectura
author      : Alberto Díaz Álvarez <alberto.diaz@upm.es>
description : >
  TBD
marp        : true
paginate    : true
theme       : bbdd
---

<!-- _class: titlepage -->

# Arquitectura

## Apache Cassandra - Bases de datos II

### Alberto Díaz Álvarez (<small><alberto.díaz@upm.es></small>)

#### Departamento de Sistemas Informáticos

##### Escuela Técnica superior de Ingeniería de Sistemas Informáticos

[![height:30](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-informational.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)

---

# Un poquito de arquitectura<!-- _class: section -->


---

# Modelo de datos<!-- _class: section -->

---

# Replicación de datos<!-- _class: section -->

---

# Operaciones de lectura/escritura<!-- _class: section -->

---

# Proceso de escritura a nivel de nodo

Cassandra procesa los datos en varias etapas durante la escritura:

1. Registro de la operación en el `CommitLog`
1. Escritura de datos en la `Memtable`
1. Descarga de datos de la `Memtable` a las `SSTables`

<center><img style="width:50%" src="images/t4/escritura-en-nodo.png" width="80%"></center>

**La escritura se realiza en paralelo**, a nivel de clúster, llegando a todos los nodos que mantienen réplicas

---

# Proceso de lectura a nivel de nodo

La lectura en Apache Cassandra es más compleja que la escritura

<center><img src="images/t4/lectura-de-nodo.png" width="80%"></center><!-- TODO: Rehacer este dibujo -->

---

# Proceso de escritura a nivel de nodo (II)

- Los datos en disco pueden estar fragmentados en varias SSTables
- Necesita consolidar los datos existentes en Memtables y SSTables
- La lectura necesita identificar la SSTable que más probablemente contenga información sobre las particiones que estamos consultando
- Esta selección se realiza mediante la información del `BloomFilter`.

---

# Proceso de escritura a nivel de nodo (y III)

Los pasos para la lectura son los siguientes:

1. Comprobación de la `Memtable`
1. Comprobación del `BloomFilter`
1. Comprobación en caché de claves de partición (si está activa)
1. Si la partición no está en la caché, se comprueba el resumen (*summary*) de la partición
1. Se accede al índice de la partición
1. Se localizan los datos en el disco
1. Se obtienen los datos de la `SSTable`
1. Antes de devolverlos, los datos se consolidan a partir de la `Memtable` y la `SSTable`

Vamos, que es un proceso algo largo y tedioso

---

# Compresión de datos<!-- _class: section -->

---

# Consistencia de datos ajustable<!-- _class: section -->

---

# _Gossip Protocol_<!-- _class: section -->

---

# Detección de fallos<!-- _class: section -->

---

# HintedHandoffs<!-- _class: section -->

---

# Filtros de Bloom<!-- _class: section -->

---

# Gracias<!-- _class: section -->
